#
# Example environment file for Eclipse Scalper
# Copy to .env and edit values for your setup.
#

# Exchange keys
BINANCE_API_KEY=your_key_here
BINANCE_API_SECRET=your_secret_here

# Core runtime
SCALPER_DRY_RUN=1
SCALPER_SIGNAL_PROFILE=micro
ENTRY_LOOP_MODE=full
ACTIVE_SYMBOLS=BTCUSDT,ETHUSDT

# Notifications (optional)
TELEGRAM_TOKEN=
TELEGRAM_CHAT_ID=

# Telemetry helpers (keep logs + alerting paths consistent with run scripts)
TELEMETRY_PATH=logs/telemetry.jsonl
TELEMETRY_ALERT_SUMMARY=1
TELEMETRY_ANOMALY_STATE=logs/telemetry_anomaly_state.json
TELEMETRY_ANOMALY_ACTIONS=logs/telemetry_anomaly_actions.json
TELEMETRY_DRIFT_PATH=logs/telemetry_drift.jsonl
TELEMETRY_GUARD_HISTORY_EVENTS=logs/telemetry_guard_history_events.jsonl
ADAPTIVE_GUARD_STATE=logs/telemetry_adaptive_guard.json
RECONCILE_FIRST_GATE_SEVERITY_THRESHOLD=0.85
RECONCILE_FIRST_GATE_SEVERITY_STREAK_THRESHOLD=2
RELIABILITY_GATE_PATH=logs/reliability_gate.txt
RELIABILITY_GATE_WINDOW_SECONDS=14400
RELIABILITY_GATE_MAX_REPLAY_MISMATCH=0
RELIABILITY_GATE_MAX_INVALID_TRANSITIONS=0
RELIABILITY_GATE_MIN_JOURNAL_COVERAGE=0.90
RELIABILITY_GATE_MAX_POSITION_MISMATCH=1
RELIABILITY_GATE_MAX_POSITION_MISMATCH_PEAK=2
RELIABILITY_GATE_MAX_ORPHAN_COUNT=0
RELIABILITY_GATE_MAX_INTENT_COLLISION_COUNT=0
INTENT_COLLISION_CRITICAL_THRESHOLD=1
INTENT_COLLISION_CRITICAL_STREAK=2
RELIABILITY_GATE_MAX_COVERAGE_GAP_SECONDS=0
RELIABILITY_GATE_MAX_COVERAGE_GAP_SECONDS_PEAK=30
RELIABILITY_GATE_MAX_STAGE1_PROTECTION_FAIL_COUNT=0
RELIABILITY_GATE_MAX_REPLACE_RACE_COUNT=1
RELIABILITY_GATE_MAX_EVIDENCE_CONTRADICTION_COUNT=2
BOOT_MAINTENANCE_ONESHOT=0
CORR_STRESS_THRESHOLD=1
CORR_PRESSURE_THRESHOLD=0.90
CORR_EXIT_PNL_DROP_THRESHOLD=0.10
# Backward-compat fallback aliases (optional):
# CORR_STRESS_CRITICAL_THRESHOLD=1
# CORR_PRESSURE_CRITICAL_THRESHOLD=0.90
# CORR_EXIT_PNL_DROP_CRITICAL_THRESHOLD=0.10
RUNTIME_RELIABILITY_COUPLING=1
BELIEF_RUNTIME_GATE_RECOVER_SEC=120
BELIEF_RUNTIME_GATE_WARMUP_NOTIONAL_SCALE=0.50
BELIEF_RUNTIME_GATE_WARMUP_LEVERAGE_SCALE=0.60
BELIEF_RUNTIME_GATE_CRITICAL_TRIP_THRESHOLD=4.0
BELIEF_RUNTIME_GATE_CRITICAL_CLEAR_THRESHOLD=2.0
BELIEF_RECONCILE_FIRST_GATE_COUNT_THRESHOLD=2
BELIEF_RECONCILE_FIRST_GATE_SEVERITY_THRESHOLD=0.85
BELIEF_RECONCILE_FIRST_GATE_STREAK_THRESHOLD=2
BELIEF_POST_RED_WARMUP_SEC=180
BELIEF_POST_RED_WARMUP_NOTIONAL_SCALE=0.60
BELIEF_POST_RED_WARMUP_LEVERAGE_SCALE=0.70
BELIEF_POST_RED_WARMUP_MIN_CONF_EXTRA=0.06
BELIEF_POST_RED_WARMUP_COOLDOWN_EXTRA_SEC=20
# Dashboard strip thresholds (top reliability counters)
TELEMETRY_DASHBOARD_DEBT_WARN_SEC=30
TELEMETRY_DASHBOARD_DEBT_CRIT_SEC=90
TELEMETRY_DASHBOARD_MISMATCH_STREAK_WARN=3
TELEMETRY_DASHBOARD_MISMATCH_STREAK_CRIT=8
TELEMETRY_DASHBOARD_COVERAGE_GAP_WARN_SEC=2
TELEMETRY_DASHBOARD_COVERAGE_GAP_CRIT_SEC=5
TELEMETRY_DASHBOARD_REFRESH_BLOCKED_WARN=1
TELEMETRY_DASHBOARD_REFRESH_BLOCKED_CRIT=4
TELEMETRY_DASHBOARD_FORCE_OVERRIDE_WARN=1
TELEMETRY_DASHBOARD_FORCE_OVERRIDE_CRIT=3
PROTECTION_REFRESH_BUDGET_BLOCKED_CRITICAL_THRESHOLD=2
PROTECTION_REFRESH_FORCE_OVERRIDE_CRITICAL_THRESHOLD=2
ADAPTIVE_GUARD_DURATION_SEC=900
ADAPTIVE_GUARD_DRIFT_DURATION_SEC=900
ADAPTIVE_GUARD_EXIT_DURATION_SEC=600
ADAPTIVE_GUARD_TELEMETRY_DURATION_SEC=600
ADAPTIVE_GUARD_PARTIAL_DELTA=0.10
ADAPTIVE_GUARD_PARTIAL_DURATION_SEC=600
ADAPTIVE_GUARD_RETRY_DELTA=0.15
ADAPTIVE_GUARD_RETRY_DURATION_SEC=600
ADAPTIVE_GUARD_GUARD_HISTORY_DELTA=0.10
ADAPTIVE_GUARD_GUARD_HISTORY_DURATION_SEC=900
ADAPTIVE_GUARD_GUARD_HISTORY_LEVERAGE_SCALE=0.85
ADAPTIVE_GUARD_GUARD_HISTORY_LEVERAGE_DURATION_SEC=900
ADAPTIVE_GUARD_GUARD_HISTORY_NOTIONAL_SCALE=0.80
ADAPTIVE_GUARD_GUARD_HISTORY_NOTIONAL_DURATION_SEC=900
ADAPTIVE_GUARD_LEVERAGE_SCALE=1
ADAPTIVE_GUARD_NOTIONAL_SCALE=1
CORE_HEALTH_EQUITY=100000

# Guard defaults
SCALPER_DATA_MAX_STALE_SEC=180
SCALPER_SESSION_UTC=
SCALPER_SESSION_MOM_UTC=
SCALPER_SESSION_MOM_MIN=0.0015
SCALPER_COOLDOWN_LOSSES=0
SCALPER_COOLDOWN_MINUTES=0

# Volatility regime guard + adaptive thresholds
SCALPER_VOL_REGIME_ENABLED=1
SCALPER_VOL_REGIME_GUARD=1
SCALPER_VOL_REGIME_LOW_ATR_PCT=0.0010
SCALPER_VOL_REGIME_HIGH_ATR_PCT=0.0030
SCALPER_VOL_REGIME_LOW_BB_PCT=0.012
SCALPER_VOL_REGIME_HIGH_BB_PCT=0.035
SCALPER_VOL_REGIME_LOW_MULT=1.15
SCALPER_VOL_REGIME_HIGH_MULT=0.90

# Confidence tuning (optional)
SCALPER_CONFIDENCE_POWER=1.0
SCALPER_CONFIDENCE_MIN=0.0
SCALPER_CONFIDENCE_MAX=1.0
SCALPER_CONFIDENCE_DIAG=0

# Signal tuning (optional)
SCALPER_VWAP_BASE_DIST=0.010
SCALPER_VWAP_ATR_MULT=1.60
SCALPER_DYN_MOM_MULT=1.45
SCALPER_DYN_MOM_FLOOR=0.0012
# Per-symbol overrides (example)
SCALPER_VWAP_BASE_DIST_DOGE=
SCALPER_VWAP_ATR_MULT_DOGE=
SCALPER_DYN_MOM_MULT_DOGE=
SCALPER_DYN_MOM_FLOOR_DOGE=

# Trend confirmation defaults
SCALPER_TREND_CONFIRM=1
SCALPER_TREND_CONFIRM_MODE=gate
SCALPER_TREND_CONFIRM_TF=1h
SCALPER_TREND_CONFIRM_FAST=50
SCALPER_TREND_CONFIRM_SLOW=200

# Strategy audit (optional)
SCALPER_AUDIT=0
SCALPER_AUDIT_COOLDOWN_SEC=5
SCALPER_AUDIT_PATH=logs/strategy_audit.csv

# Risk controls (recommended)
MAX_DAILY_LOSS_PCT=0.02
MAX_DRAWDOWN_PCT=0.06
KILL_DAILY_HALT_SEC=3600
KILL_DRAWDOWN_HALT_SEC=3600
KILL_DAILY_HALT_UNTIL_UTC=1

# Sizing + leverage
FIXED_NOTIONAL_USDT=10
LEVERAGE=1
LEVERAGE_MIN=1
LEVERAGE_MAX=125
LEVERAGE_BY_SYMBOL=
LEVERAGE_BY_GROUP=
LEVERAGE_BTCUSDT=
LEVERAGE_GROUP_DYNAMIC=1
LEVERAGE_GROUP_SCALE=0.7
LEVERAGE_GROUP_SCALE_MIN=1
LEVERAGE_GROUP_EXCLUDE_SELF=1
LEVERAGE_GROUP_EXPOSURE=0
LEVERAGE_GROUP_EXPOSURE_REF_PCT=0.10
MARGIN_MODE=isolated
# Per-symbol sizing overrides (example)
FIXED_NOTIONAL_USDT_DOGE=
FIXED_QTY_DOGE=

# Live safety allowlist
FIRST_LIVE_SAFE=1
FIRST_LIVE_SYMBOLS=BTCUSDT,ETHUSDT
FIRST_LIVE_MAX_NOTIONAL_USDT=10

# Correlation group caps
CORR_GROUPS=MAJOR:BTCUSDT,ETHUSDT
CORR_GROUP_MAX_POSITIONS=1
CORR_GROUP_MAX_NOTIONAL_USDT=25
CORR_GROUP_LIMITS=MAJOR=1
CORR_GROUP_NOTIONAL=MAJOR=25
CORR_GROUP_SCALE_ENABLED=1
CORR_GROUP_SCALE=0.70
CORR_GROUP_SCALE_MIN=0.25
CORR_GROUP_SCALE_BY_GROUP=
CORR_GROUP_EXPOSURE_SCALE_ENABLED=0
CORR_GROUP_EXPOSURE_SCALE=0.7
CORR_GROUP_EXPOSURE_SCALE_MIN=0.25
CORR_GROUP_EXPOSURE_REF_NOTIONAL=0
CORR_GROUP_EXPOSURE_SCALE_BY_GROUP=
CORR_GROUP_EXPOSURE_SCALE_MIN_BY_GROUP=
CORR_GROUP_EXPOSURE_REF_NOTIONAL_BY_GROUP=

# Diagnostics (optional)
SCALPER_SIGNAL_DIAG=0
SCALPER_DEBUG_LOOSE=0
SCALPER_QUALITY_MODE=0
SCALPER_QUALITY_CONF_MIN=0.60

# Entry loop & follow-through
ENTRY_LOOP_MODE=full
ENTRY_RESPECT_KILL_SWITCH=1
ENTRY_FOLLOW_THROUGH=0
ENTRY_FOLLOW_THROUGH_MIN_MOVE_PCT=0.0005
ENTRY_MIN_CONFIDENCE=0.0
MIN_CONFIDENCE=0.0
ENTRY_BLOCK_ON_ROUTER_BLOCK=1
ENTRY_BLOCK_ROUTER_WINDOW_SEC=60
ENTRY_BLOCK_ROUTER_THRESHOLD=1
ENTRY_BLOCK_ROUTER_BACKOFF_SEC=10
ENTRY_BLOCK_ON_ERRORS=0
ENTRY_BLOCK_ERRORS_WINDOW_SEC=60
ENTRY_BLOCK_ERRORS_THRESHOLD=3
ENTRY_BLOCK_ERRORS_BACKOFF_SEC=15
ENTRY_PARTIAL_MIN_FILL_RATIO=0.5
ENTRY_PARTIAL_CANCEL=1
ENTRY_PARTIAL_BACKOFF_SEC=10
ENTRY_DATA_MAX_STALE_SEC=180
ENTRY_DATA_QUALITY_MIN=60
ENTRY_DATA_QUALITY_TF=1m
ENTRY_DATA_QUALITY_WINDOW=120
ENTRY_DATA_QUALITY_EMIT_SEC=60
ENTRY_DATA_QUALITY_HISTORY_MAX=50
ENTRY_DATA_QUALITY_ROLL_SEC=900
ENTRY_DATA_QUALITY_ROLL_MIN=60
ENTRY_DATA_QUALITY_KILL_SEC=120
ADAPTIVE_GUARD_QTY_SCALE=1
ENTRY_CONF_SCALE_ENABLED=0
ENTRY_CONF_SCALE_MIN_CONF=0.35
ENTRY_CONF_SCALE_MAX_CONF=0.75
ENTRY_CONF_SCALE_MIN=0.5
ENTRY_CONF_SCALE_MAX=1.0

# Router
ROUTER_AUTO_CLIENT_ID=1
ROUTER_RETRY_ALERT_TRIES=4
ROUTER_RETRY_ALERT_COOLDOWN_SEC=60

# Position manager
POSMGR_ENABLED=1
POSMGR_TICK_SEC=2
POSMGR_ENSURE_STOP=1
POSMGR_STOP_CHECK_SEC=90
POSMGR_STOP_RESTORE_COOLDOWN_SEC=300
POSMGR_OPEN_ORDERS_MIN_INTERVAL_SEC=12
POSMGR_BE_STOP_TOLERANCE_PCT=0.005

# Exit / trailing
EXIT_ENABLED=1
EXIT_TICK_SEC=2
EXIT_MAX_HOLD_SEC=2400
EXIT_TIME_COOLDOWN_SEC=10
EXIT_STAGNATION_SEC=900
EXIT_STAGNATION_ATR=0.15
EXIT_MOM_ENABLED=0
EXIT_MOM_MIN=0.0015
EXIT_MOM_REQUIRE_BOTH=1
EXIT_VWAP_ENABLED=0
EXIT_VWAP_TF=5m
EXIT_VWAP_WINDOW=240
EXIT_VWAP_REQUIRE_CROSS=1
# Per-symbol exit timing overrides (example)
EXIT_MAX_HOLD_SEC_DOGE=
EXIT_STAGNATION_SEC_DOGE=
EXIT_STAGNATION_ATR_DOGE=

# Exit ATR scaling (optional)
EXIT_ATR_SCALE_ENABLED=0
EXIT_ATR_SCALE_REF_PCT=0.003
EXIT_ATR_SCALE_MIN=0.6
EXIT_ATR_SCALE_MAX=1.6
# Per-symbol overrides (example)
EXIT_ATR_SCALE_REF_PCT_DOGE=
EXIT_ATR_SCALE_MIN_DOGE=
EXIT_ATR_SCALE_MAX_DOGE=
TRAILING_ACTIVATION_RR=0
TRAILING_REBUILD_DEBOUNCE_SEC=999999
DUAL_TRAILING=0

# Exit tuning
STOP_ATR_MULT=0.8
TP1_RR_MULT=1.0
TP2_RR_MULT=2.0
TP_ATR_MULT=1.8

# Reconcile protection refresh (anti-churn partial-fill handling)
RECONCILE_STOP_MIN_COVERAGE_RATIO=0.98
RECONCILE_STOP_REFRESH_MIN_DELTA_RATIO=0.10
RECONCILE_STOP_REFRESH_MIN_DELTA_ABS=0.0
RECONCILE_STOP_REFRESH_MAX_INTERVAL_SEC=45
RECONCILE_STOP_REFRESH_FORCE_COVERAGE_RATIO=0.80
RECONCILE_STOP_REFRESH_BUDGET_WINDOW_SEC=60
RECONCILE_STOP_REFRESH_MAX_PER_WINDOW=3
RECONCILE_STOP_REPLACE_RETRIES=2
BELIEF_PROTECTION_REFRESH_DECAY_SEC=180
BELIEF_PROTECTION_REFRESH_RECOVER_SEC=90
BELIEF_PROTECTION_REFRESH_WARMUP_NOTIONAL_SCALE=0.80
BELIEF_PROTECTION_REFRESH_WARMUP_LEVERAGE_SCALE=0.85
BELIEF_PROTECTION_REFRESH_WARMUP_MIN_CONF_EXTRA=0.03
BELIEF_PROTECTION_REFRESH_WARMUP_COOLDOWN_EXTRA_SEC=8

# TP protection refresh (opt-in)
GUARDIAN_ENSURE_TP=0
RECONCILE_TP_MIN_COVERAGE_RATIO=0.98
RECONCILE_TP_REFRESH_MIN_DELTA_RATIO=0.10
RECONCILE_TP_REFRESH_MIN_DELTA_ABS=0.0
RECONCILE_TP_REFRESH_MAX_INTERVAL_SEC=45
RECONCILE_TP_REFRESH_FORCE_COVERAGE_RATIO=0.80
RECONCILE_TP_REFRESH_BUDGET_WINDOW_SEC=60
RECONCILE_TP_REFRESH_MAX_PER_WINDOW=3
RECONCILE_TP_REPLACE_RETRIES=2
RECONCILE_TP_FALLBACK_PCT=0.0050

# Exit telemetry guard (forces earlier exits when telemetry flags high exposure)
EXIT_TELEMETRY_HIGH_EXPOSURE_USDT=0
EXIT_TELEMETRY_FORCE_HOLD_SEC=0
EXIT_TELEMETRY_COOLDOWN_MULT=0.5
EXIT_TELEMETRY_ALERT_INTERVAL_SEC=300
TELEMETRY_GUARD_HISTORY_ACTIONS=logs/telemetry_guard_history_actions.json
EXIT_GUARD_HISTORY_HOLD_SCALE=0.70
EXIT_GUARD_HISTORY_STAGNATION_SCALE=0.70
EXIT_SIGNAL_FEEDBACK_PATH=logs/signal_exit_feedback.json
EXIT_SIGNAL_FEEDBACK_MIN_RATIO=0.25
EXIT_SIGNAL_FEEDBACK_MIN_COUNT=3
EXIT_SIGNAL_FEEDBACK_HOLD_SCALE=0.70
EXIT_SIGNAL_FEEDBACK_STAGNATION_SCALE=0.70

# ═══════════════════════════════════════════════════════════════════════════════
# PHASE 1: Critical Safety Patches
# ═══════════════════════════════════════════════════════════════════════════════

# Position Lock Manager (atomic position dict operations)
POSITION_LOCK_ENABLED=1
POSITION_LOCK_TIMEOUT_SEC=5.0

# Intent Ledger Persistence (WAL-style crash-safe persistence)
INTENT_LEDGER_ENABLED=1
INTENT_LEDGER_PATH=logs/intent_ledger.jsonl
INTENT_LEDGER_CHECKPOINT_SEC=30.0
INTENT_LEDGER_CHECKPOINT_RECORDS=100
INTENT_LEDGER_WRITE_RETRIES=3
INTENT_LEDGER_FSYNC_CRITICAL=1

# Flatten Intent Manager (emergency flat crash recovery)
FLATTEN_INTENT_ENABLED=1
FLATTEN_INTENT_MAX_AGE_SEC=3600
FLATTEN_INTENT_MAX_ATTEMPTS=5

# ═══════════════════════════════════════════════════════════════════════════════
# PHASE 2: Reliability Hardening
# ═══════════════════════════════════════════════════════════════════════════════

# Circuit Breaker (cascade failure prevention)
CIRCUIT_BREAKER_ENABLED=1
CIRCUIT_FAILURE_THRESHOLD=5
CIRCUIT_RECOVERY_TIMEOUT_SEC=30.0
CIRCUIT_HALF_OPEN_MAX_REQUESTS=3
CIRCUIT_SUCCESS_THRESHOLD=2

# Rate Limiter (token bucket + Binance weight tracking)
RATE_LIMITER_ENABLED=1
RATE_LIMIT_PER_SEC=10.0
RATE_LIMIT_BURST=20
RATE_LIMIT_BACKOFF_SEC=1.0
RATE_LIMIT_BACKOFF_MAX_SEC=60.0
RATE_LIMIT_BACKOFF_MULT=2.0
BINANCE_WEIGHT_LIMIT=1200
BINANCE_WEIGHT_WINDOW_SEC=60

# Order Verifier (SUBMITTED_UNKNOWN state resolution)
ORDER_VERIFIER_ENABLED=1
ORDER_VERIFY_RETRIES=3
ORDER_VERIFY_TIMEOUT_SEC=10.0
ORDER_VERIFY_BACKOFF_BASE=1.0
ORDER_VERIFY_INTERVAL_SEC=60.0

# ═══════════════════════════════════════════════════════════════════════════════
# PHASE 3: Scalability & Observability
# ═══════════════════════════════════════════════════════════════════════════════

# Health Monitor (component health checks)
HEALTH_MONITOR_ENABLED=1
HEALTH_CHECK_INTERVAL_SEC=30.0
HEALTH_EXCHANGE_TIMEOUT_SEC=10.0

# Metrics Collector (counters, gauges, histograms)
METRICS_ENABLED=1
METRICS_WINDOW_SEC=60
METRICS_MAX_SAMPLES=1000

# System Status Reporter (unified status reporting)
SYSTEM_STATUS_ENABLED=1
STATUS_INTERVAL_SEC=300.0
